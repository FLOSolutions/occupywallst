{% load ows %}
{% load i18n %}
{% load cache %}

<article id="{{ article.slug }}">
  {% if user.is_authenticated and user == article.author %}
    <a class="edit" href="#">[{% trans "edit" %}]</a>
    <a class="delete" href="#">[{% trans "delete" %}]</a>
  {% endif %}
  {% if user.is_staff %}
    {% if article.is_forum %}
      <a href="/admin/occupywallst/forumpost/{{ article.id }}/">[admin edit]</a>
    {% else %}
      <a href="/admin/occupywallst/newsarticle/{{ article.id }}/">[admin edit]</a>
    {% endif %}
  {% endif %}

  {% get_current_language as LANGUAGE_CODE %}
  {% cache 60 article_content article.id LANGUAGE_CODE %}
    {% translate_object article LANGUAGE_CODE %}
    <h1><a href="{{ article.get_absolute_url }}">{{ article.title }}</a></h1>
    <p class="info">
      {% if forum %}
        {% trans "Posted" %} {{ article.published|timesince_short }} {% trans "ago" %}
      {% else %}
        {% trans "Posted" %} {{ article.published|as_timezone:"US/Eastern"|date:"DATETIME_FORMAT" }} EST
      {% endif %}
      {% trans "by" %} {% if not article.author %}anonymous{% else %}
        <a rel="author" title="View {{ article.author.username }}'s profile"
           class="user" href="{{ article.author.get_absolute_url }}">
        {{ article.author.username }}</a>
        {% if article.is_forum %}
          {% if article.author.userinfo.city and article.author.userinfo.region %}
            ({{ article.author.userinfo.city }}, {{ article.author.userinfo.region }})
          {% endif %}
        {% endif %}
      {% endif %}
    </p>
    <div class="words">
      {% if article.allow_html %}
        {{ article.content|markup_unsafe }}
      {% else %}
        {{ article.content|markup }}
      {% endif %}
    </div>
  {% endcache %}

</article>
