{% extends base %}

{% block title %}{{ obj.username }}'s User Profile | OccupyWallSt.org{% endblock title %}

{% block scripts %}
  <script src="//maps.google.com/maps/api/js?sensor=false&region=us" type="text/javascript"></script>
  <script src="//maps.google.com/maps/api/js?libraries=places&sensor=false&region=us" type="text/javascript"></script>
{% endblock scripts %}

{% block js_init %}
  {{ block.super }}
  userpage_init({
    {% if obj.userinfo.position %}
      map: $("#map").get(0),
      lat: {{ obj.userinfo.position_lat }},
      lng: {{ obj.userinfo.position_lng }}
    {% endif %}
  });
{% endblock js_init %}

{% block content %}
  <table style="width:100%"><tbody><tr><td id="left">
    <h1 class="username" id="{{ obj.username }}">{{ obj.username }}</h1>
    <section id="user-profile">
      {% if obj.userinfo.info %}
        {{ obj.userinfo.info|linebreaks }}
      {% else %}
        <p style="color:#333">No Profile Information</p>
      {% endif %}
    </section>

    <h2>Private Messages</h2>

    {% if user.is_authenticated %}
      <p class="postform">
        <textarea rows="5" cols="50"></textarea><br />
        <button class="save">send message</button>
        <img class="loader" src="/media/img/ajax-loader.gif"
             width="16" height="16" />
        <span class="error"></span>
      </p>
      <div id="messages">
        {% for message in messages %}
          {% include "occupywallst/message.html" %}
        {% endfor %}
      </div>
    {% else %}
      <p>Must be <a href="/login/">logged in</a> to send messages.</p>
    {% endif %}

  </td><td id="right">

    <h2 style="margin-top:0">Information</h2>
    <section id="user-info">
      <p>
        {{ obj.username }} 
        {% if obj.userinfo.city and obj.userinfo.region %}
          is from
          <strong>{{ obj.userinfo.city }}, {{ obj.userinfo.region }}</strong>
          and
        {% endif %}
      {% if obj.userinfo.attendance == "yes" %}
        <span class="attendance yes">will attend</span>
      {% endif %}
      {% if obj.userinfo.attendance == "no" %}
        <span class="attendance no">can't make it</span> to
      {% endif %}
      {% if obj.userinfo.attendance == "maybe" %}
        <span class="attendance maybe">might be able to attend</span>
      {% endif %}
      the occupation.
      {% if obj.userinfo.need_ride %}
        They also <strong>need a ride</strong>!
      {% endif %}
      {% if obj.userinfo.position %}
        <div id="map" style="width: 250px; height: 200px;"></div>
      {% else %}
        <p>They also didn't specify their location.</p>
      {% endif %}
    </section>

    {% if obj.userinfo.position %}
      <h2>Nearby Users</h2>
      <section id="nearby-users">
        <ul>
          {% for obj in nearby %}
            <li>
              <a href="{{ obj.get_absolute_url }}">{{ obj }}</a>
              <span class="tinygray">{{ obj.distance.mi|floatformat:0 }} miles</span>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}

  </td></tr></tbody></table>
{% endblock content %}
